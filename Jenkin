pipeline {

environment {
registry = "web/demo"
registryCredential = 'dockerhub'
dockerImage = ''}

agent any

stages {
stage('Cloning Git') {
 steps {
 git 'https://github.com/johnsimon007/WebGoat.git'
 }
 }
stage('Building image') {
 steps{
 script {
 dockerImage = docker.build registry + ":$BUILD_NUMBER"
 }
 }
 }
    
    
        stage('Scan') {
            steps {        
                sh 'apk add bash curl'
                sh 'curl -s https://ci-tools.anchore.io/inline_scan-v0.6.0 | bash -s -- -d Dockerfile -b .anchore_policy.json ${registry}:$BUILD_NUMBER'
            }
        }
       
    }
}
